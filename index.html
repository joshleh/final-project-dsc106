<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Activity & Temperature Analysis</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        .chart-container { width: 80%; margin: auto; }
        .tooltip { position: absolute; background: white; padding: 5px; border: 1px solid black; visibility: hidden; }
        .legend { font-size: 14px; }
    </style>
</head>
<body>
    <h1>Rhythms of the Night: Analyzing Mouse Activity and Temperature Cycles</h1>
    <p>This project explores the relationship between activity levels and body temperature in mice over a 14-day period.</p>
    
    <h2>Average Temperature Trends</h2>
    <div class="chart-container">
        <svg id="temperatureChart" width="800" height="400"></svg>
    </div>
    
    <h2>Activity Trends Over Time</h2>
    <div class="chart-container">
        <svg id="activityChart" width="800" height="400"></svg>
    </div>
    
    <h2>Project Progress</h2>
    <p><b>What have you done so far?</b></p>
    <p>So far, we have structured our webpage, implemented an initial interactive visualization for temperature trends, and laid the foundation for additional visualizations. We are using D3.js to render data dynamically, and the project is being prepared for deployment via GitHub Pages.</p>
    
    <p><b>What will be the most challenging part of your project to design and why?</b></p>
    <p>The most challenging part will be implementing meaningful interactivity that allows users to engage with the data in a useful way. Designing interactive components such as toggling between male and female datasets, hover effects, and comparisons between estrus and non-estrus states will require thoughtful design and testing.</p>
    
    <script>
        // Function to load and process the actual dataset
        async function loadAndProcessData() {
            const response = await fetch('mouse_data.csv'); // Ensure this file is accessible
            const text = await response.text();
            const rows = text.trim().split('\n').map(row => row.split(','));
            
            const columnNames = rows[0]; // First row contains headers
            const data = rows.slice(1).map(row => row.map(parseFloat)); // Convert to numbers
            
            // Assuming first half of columns are temperature, second half are activity
            const midPoint = Math.floor(columnNames.length / 2);
            const temperatureCols = data.map(row => row.slice(0, midPoint));
            const activityCols = data.map(row => row.slice(midPoint));
            
            // Compute average temperature and activity over time
            const temperatureData = temperatureCols.map((row, i) => ({
                time: i / 1440, // Convert minutes to days
                avgTemp: row.reduce((sum, val) => sum + val, 0) / row.length
            }));
            
            const activityData = activityCols.map((row, i) => ({
                time: i / 1440, // Convert minutes to days
                avgActivity: row.reduce((sum, val) => sum + val, 0) / row.length
            }));
            
            createLineChart("#temperatureChart", temperatureData, "time", "avgTemp", "Temperature (Â°C)", "blue");
            createLineChart("#activityChart", activityData, "time", "avgActivity", "Activity Level", "green");
        }
        
        function createLineChart(svgId, data, xKey, yKey, yLabel, color) {
            const svg = d3.select(svgId),
                  margin = {top: 20, right: 30, bottom: 50, left: 60},
                  width = +svg.attr("width") - margin.left - margin.right,
                  height = +svg.attr("height") - margin.top - margin.bottom;
            
            const x = d3.scaleLinear().domain([0, d3.max(data, d => d[xKey])]).range([0, width]);
            const y = d3.scaleLinear().domain([d3.min(data, d => d[yKey]) - 1, d3.max(data, d => d[yKey]) + 1]).range([height, 0]);
            
            const line = d3.line()
                .x(d => x(d[xKey]))
                .y(d => y(d[yKey]));
            
            const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
            
            g.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d => `${d} Days`))
                .append("text")
                .attr("x", width / 2)
                .attr("y", 40)
                .attr("fill", "black")
                .text("Time (Days)");
            
            g.append("g")
                .call(d3.axisLeft(y))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -50)
                .attr("fill", "black")
                .text(yLabel);
            
            g.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", color)
                .attr("stroke-width", 2)
                .attr("d", line);
        }
        
        // Load and process the actual dataset on page load
        loadAndProcessData();
    </script>
</body>
</html>
