<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Activity & Temperature Analysis</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Rhythms of the Night: Analyzing Mouse Activity and Temperature Cycles</h1>
    <p>This project explores the relationship between activity levels and body temperature in mice over a 14-day period.</p>
    
    <label for="timeRange">Select Time Range:</label>
    <select id="timeRange" onchange="loadAndProcessData()">
        <option value="all">All 14 Days</option>
        <option value="week1">Week 1</option>
        <option value="week2">Week 2</option>
        <option value="day1">Day 1</option>
        <option value="day2">Day 2</option>
        <option value="day3">Day 3</option>
        <option value="day4">Day 4</option>
        <option value="day5">Day 5</option>
        <option value="day6">Day 6</option>
        <option value="day7">Day 7</option>
        <option value="day8">Day 8</option>
        <option value="day9">Day 9</option>
        <option value="day10">Day 10</option>
        <option value="day11">Day 11</option>
        <option value="day12">Day 12</option>
        <option value="day13">Day 13</option>
        <option value="day14">Day 14</option>
    </select>
    
    <h2>Average Temperature Trends</h2>
    <div class="chart-container">
        <svg id="temperatureChart" width="800" height="400"></svg>
        <div class="legend">
            <span style="color: blue;">■ Female</span>
            <span style="color: red;">■ Male</span>
        </div>
    </div>
    
    <h2>Activity Trends Over Time</h2>
    <div class="chart-container">
        <svg id="activityChart" width="800" height="400"></svg>
        <div class="legend">
            <span style="color: green;">■ Female</span>
            <span style="color: orange;">■ Male</span>
        </div>
    </div>
    
    <script>
        async function loadCSV(file) {
            try {
                const response = await fetch(file);
                if (!response.ok) {
                    throw new Error(`Failed to load ${file}: ${response.statusText}`);
                }
                const text = await response.text();
                return text.trim().split('\n').map(row => row.split(',').map(parseFloat));
            } catch (error) {
                console.error(error);
                return [];
            }
        }
        
        async function loadAndProcessData() {
            console.log("Loading datasets...");
            const femaleTempData = await loadCSV('data/female_temp.csv');
            const maleTempData = await loadCSV('data/male_temp.csv');
            const femaleActData = await loadCSV('data/female_act.csv');
            const maleActData = await loadCSV('data/male_act.csv');
            
            if (!femaleTempData.length || !maleTempData.length || !femaleActData.length || !maleActData.length) {
                console.error("One or more datasets failed to load.");
                return;
            }
            console.log("Datasets loaded successfully.");
            
            const selectedRange = document.getElementById("timeRange").value;
            let start = 0, end = femaleTempData.length;
            let xLabel = "Time (Days)";
            
            if (selectedRange.startsWith("week")) {
                start = selectedRange === "week1" ? 0 : 7 * 1440;
                end = start + 7 * 1440;
            } else if (selectedRange.startsWith("day")) {
                start = (parseInt(selectedRange.replace("day", "")) - 1) * 1440;
                end = start + 1440;
                xLabel = "Time (Minutes)";
            }
            
            const temperatureData = femaleTempData.slice(start, end).map((row, i) => ({
                time: i / (selectedRange.startsWith("day") ? 1 : 1440),
                femaleTemp: row[0],
                maleTemp: maleTempData[i] ? maleTempData[i][0] : null
            }));
            
            const activityData = femaleActData.slice(start, end).map((row, i) => ({
                time: i / (selectedRange.startsWith("day") ? 1 : 1440),
                femaleActivity: row[0],
                maleActivity: maleActData[i] ? maleActData[i][0] : null
            }));
            
            console.log("Processed Data Sample:", temperatureData.slice(0, 10), activityData.slice(0, 10));
            
            createLineChart("#temperatureChart", temperatureData, "time", ["femaleTemp", "maleTemp"], "Temperature (°C)", ["blue", "red"], xLabel);
            createLineChart("#activityChart", activityData, "time", ["femaleActivity", "maleActivity"], "Activity Level", ["green", "orange"], xLabel);
        }
        
        function createLineChart(svgId, data, xKey, yKeys, yLabel, colors, xLabel) {
            const svg = d3.select(svgId).html(""),
                  margin = {top: 20, right: 30, bottom: 50, left: 60},
                  width = +svg.attr("width") - margin.left - margin.right,
                  height = +svg.attr("height") - margin.top - margin.bottom;
            
            const x = d3.scaleLinear().domain([0, d3.max(data, d => d[xKey])]).range([0, width]);
            const y = d3.scaleLinear().domain([
                d3.min(data, d => Math.min(...yKeys.map(k => d[k]))) - 1,
                d3.max(data, d => Math.max(...yKeys.map(k => d[k]))) + 1
            ]).range([height, 0]);
        }
        
        loadAndProcessData();
    </script>
</body>
</html>
